<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
	xmlns:sp="http://www.springframework.org/tags"
	template="/template/template.xhtml">

	<ui:define name="title">        
            MOVIMENTAÇÕES SAÍDA      
    </ui:define>

	<!-- <ui:define name="header" /> -->
	<!-- <ui:define name="slide" /> -->
	<!-- <ui:define name="search" /> -->
	<!-- <ui:define name="modal" /> -->
	<!-- <ui:define name="menuLeft" /> -->
	<!-- <ui:define name="menuRight" /> -->

	<ui:define name="main">

		<ol class="breadcrumb">
			<li ><a href="#{request.contextPath}/">Página inicial</a></li>
			<li class="active"><a href="#{request.contextPath}/estacionamentos">Estacionamentos</a></li>
			<li ><a href="#{request.contextPath}/reservas">Reservas</a></li>
			<!-- <li ><a href="#{request.contextPath}/reservas_agenda">Reservas Agenda</a></li> -->
		</ol>
		<!-- //breadcrumb-->

		<div id="content">
		
			<h3>Administrar estacionamentos</h3>
			
			<h:panelGroup>
			    <h:form id="filtro" style="text-align:center;">
				<p:messages id="messagesFiltro" globalOnly="false" autoUpdate="false" showDetail="false" closable="true"
					showIcon="false" showSummary="true" />
					
				<h:outputLabel value="Situação:" styleClass="control-label" />
				<br/>
				<h:panelGroup layout="block" >
					<b:selectMultiMenu span="12" 
						allSelectedText="Todos selecionados"
						includeSelectAllOption="true"
						nonSelectedText="Selecione"
						selectAllText="Selecionar todos"
						maxHeight="300" radiobuttons="true"
						enableCaseInsensitiveFiltering="true" enableFiltering="true"
						required="true" requiredMessage="Situação Obrigatório"
						filterPlaceholder="Procurar" value="#{estacionamentoService.filtroSituacao}">
						<f:selectItem itemLabel="Todos" itemValue="todos"/>
						<f:selectItems value="#{reservaTipoService.findAll()}" var="select" 
							itemLabel="#{select.nome}" itemValue="#{select.nome}" />
					</b:selectMultiMenu>
		        </h:panelGroup>
					
				<h:outputLabel value="FILTRO DE DATA: " styleClass="control-label" style="margin-right:10px;" />
				<br/>
				<p:calendar styleClass="datetimepickerFiltroEstacionamento" id="pretencaoInicio" mask="true" 
						locale="pt" style="width: 80px ! important;"
						value="#{estacionamentoService.filtroData}" pattern="dd/MM/yyyy HH:mm" >
				</p:calendar>
					
				<p:commandButton value="filtrar" icon="fa fa-thumbs-up" style="margin-top:14px !important"
						action="#{estacionamentoService.atualizaTable}" update="messagesFiltro"
						styleClass="noui zoom btn btn-primary btn-sm" />
				
			</h:form>
		    </h:panelGroup>
			

			<h:form id="formDataTable">
			
					<p:remoteCommand name="updateDataTable" actionListener="#{facesUtil.atualizaTable('formDataTable')}" process="@this" />
					
					<ui:remove>
					<!--  
					
					<p:remoteCommand name="callAlterar" actionListener="#{reservaService.alterar}" process="@this" />
					<p:remoteCommand name="callExcluir" actionListener="#{reservaService.excluir}" process="@this" />
					<p:remoteCommand name="callStatus" actionListener="#{reservaService.status}" process="@this" />
					
					
					<p:commandButton icon="fa fa-share-square-o" value="Cadastrar"
						action="#{reservaService.add}" process="@this"
						styleClass="noui zoom btn btn-primary btn-lg" />
						
					-->
					</ui:remove>
					
					<h:panelGroup id="dataTableBlock">
					<table id="dataTable" class="table table-striped table-bordered table-hover" >
				        <thead>
				        	<tr>
				        		<th colspan="4" style="font-size:16px;">ESTACIONAMENTO DA DATA: <font color="#000">#{facesUtil.converteData(estacionamentoService.filtroData,1)}</font></th>
				        	</tr>
				            <tr>
				                <th >IDENTIFICADOR</th>
				                <th >APARTAMENTO</th>
				                <th >CLIENTE</th>
				                <th >CARRO</th>
				                <th >RESERVA</th>
				            </tr>
				        </thead>
				        <tfoot>
				            <tr>
				                <th >IDENTIFICADOR</th>
				                <th >APARTAMENTO</th>
				                <th >CLIENTE</th>
				                <th >CARRO</th>
				                <th >RESERVA</th>
				            </tr>
				        </tfoot>
			        </table>
			        </h:panelGroup>
			</h:form>

		</div>

		<!-- <ui:include src="modalApartamento.xhtml" /> -->
		<!-- <ui:include src="modalReserva.xhtml" /> -->
		
	</ui:define>

	<ui:define name="script">
	
		<script type="text/javascript">

				var body=$("body");
					body.toggleClass("in");

				window.settingsTable = {
					aoColumns: [
						// visible:true, bSearchable:true, sClass:"left select-filter"
			            //{ mDataProp: "check" },
			            //{ mDataProp: "codigo" },
			            	{ mDataProp: "identificador",sClass:"center" },
			            	{ mDataProp: "apartamento",sClass:"center" },
			            	{ mDataProp: "cliente",sClass:"center select-filter" },
			            	{ mDataProp: "carro",sClass:"center" },
			            	{ mDataProp: "reserva",sClass:"center" },
			            //{ mDataProp: "acao" },
			        ],
				}
				window.settingsTableEstacionamento = {
						sAjaxSource: window.location.href + "/lista",
						fnServerData: function ( sSource, aoData, fnCallback ) {
						    $.ajax({
						        dataType: 'json',
						        contentType: "application/json;charset=UTF-8",
						        type: "POST",
						        url: sSource,
						        success: function(json){
						        	fnCallback(json);
						        },
						        error : function (e) { /*console.log(e);*/ },
						        done : function(e) { /*console.log("DONE");*/ },
						    });
						},
						//order: [ 1, 'desc' ],
						/* select: {
						      style: 'multi',
						      selector: 'td:first-child',
						}, */
						stateSave: false,
						language: {
						      search: 'Busca:',
						      lengthMenu: 'Mostrar _MENU_ resultados',
						      infoFiltered: ' - em _MAX_ registros',
						      info: 'Mostrando de _START_ até _END_ de _TOTAL_ registros encontrados',
						      zeroRecords: 'Nenhum registro encontrado!',
						      loadingRecords: " Aguarde - carregando lista... ",
						      infoEmpty: "No records available",
						      decimal: ',',
						      thousands: '.',
						      paginate: {
						          first:    '«',
						          previous: '‹',
						          next:     '›',
						          last:     '»'
						      },
						      aria: {
						          paginate: {
						              first:    'First',
						              previous: 'Previous',
						              next:     'Next',
						              last:     'Last'
						          }
						      },
						      buttons: {
						    	  colvis: 'Exibir colunas',
						    	  colvisRestore : 'RESTAURAR',
						          pageLength: {
						             "-1": 'Exibir todos',
						              _: 'Exibindo %d'
						          }
						      },
						      select: {
						          rows: "( %d registros selecionados )"
						      }
						},
						fixedHeader: true,
						lengthMenu: [[5,10,25,50,-1],[5,10,25,50,"todos"]],
						pagingType: 'full_numbers',
						dom: 'lfrtipB',
						colVis: {
						      restore: "Restore",
						      showAll: "Show all",
						      showNone: "Show none",
						},
						buttons: [
									{
						                extend: 'colvis',
						                className: 'btn btn-default btn-click btn-sm',
						                postfixButtons: ['colvisRestore'],
						                collectionLayout: 'fixed two-column',
						                columns: ':not(.col-select)',				                    
						            },
						            {
										className: 'btn btn-default btn-click btn-sm',
										extend: 'print',
										autoPrint: false,
									    exportOptions: {
									        columns: [ ':visible:not(.noprint)' ],
									    },
						                customize: function ( win ) {
						                    $(win.document.body).css('background','none', 'important');
						                    $(win.document.body).css('padding','40px','important');
						                    $(win.document.body).find('table')
						                        .addClass( 'compact' )
						                        .css( 'font-size', 'inherit' );
						                }
									},
						 ],
						 responsive: {
							 /*breakpoints: [
							               { name: 'desktop',  width: Infinity },
										    { name: 'tablet-l', width: 1024 },
										    { name: 'tablet-p', width: 768 },
										    { name: 'mobile-l', width: 480 },
										    { name: 'mobile-p', width: 320 }
					         ],*/
					         details: {
					             //display: $.fn.dataTable.Responsive.display.modal( {
					             //    header: function ( row ) {
					             //        var data = row.data();
					             //        return 'Registro:'+row.data().codigo;
					             //    }
					             //}),
					        	 //type: 'column',
					        	 //target: -1,
					        	 type: 'column',
					             target: 'tr',
					             renderer: function ( api, rowIdx, columns ) {
					                 var data = $.map( columns, function ( col, i ) {
					                     if(col.title!='CHECK'){
					                    	 return  '<tr>'+
								                      	'<td>'+col.title+':'+'</td> '+
								                      	'<td>'+col.data+'</td>'+
								                     '</tr>';
					                     }
					                     
					                 }).join('');
					                 return $('<table class="table tableDetails" />').append( data );
					             }
					         }
					     },
						 initComplete: function () {
					        this.api().columns('.select-filter').every(function () {
					            var column = this;
					            var select = $('<select class="selectpicker"><option value="">Selecione</option></select>')
					            .appendTo($(column.footer()).empty())
					            .on('change',function () {
					                    var val = $.fn.dataTable.util.escapeRegex(
					                        $(this).val()
					                    );
					                    column
					                        .search( val ? '^'+val+'$' : '', true, false )
					                        .draw();
					                });
					            column.data().unique().sort().each( function ( d, j ) {
					                select.append( '<option value="'+d+'">'+d+'</option>' )
					                });
					            });
						 },
					}
				window.settings = {};
				settings = jsonConcat(settings, settingsTable);
				settings = jsonConcat(settings, settingsTableEstacionamento);
			    jQuery(document).ready(function(){
					window.table = $('#dataTable').DataTable(settings);
				});
	</script>
	
	</ui:define>

</ui:composition>