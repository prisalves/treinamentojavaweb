<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
	xmlns:sp="http://www.springframework.org/tags">
	
		<!-- ADD -->
		<ui:include src="modalPredio.xhtml" />
		<ui:include src="../pessoa/modalProprietario.xhtml" />
		
		<!-- MODAL -->
		<b:modal id="modalApartamento" title="Apartamento" size="modal-lg"
			styleClass="animated sake" close-on-escape="false" closable="true"
			backdrop="false">
			
			<!-- FORM MODAL -->
			<h:form styleClass="form-horizontal row-border" id="formApartamento">

				<!-- MENSAGENS -->
				<p:messages id="messagesApartamento" globalOnly="false" autoUpdate="false" showDetail="false" closable="true"
					showIcon="false" showSummary="true" />
					
				<!-- PROPRIETARIO -->
				<b:panelGrid colSpans="2,5,5" size="sm" id="selectProprietario">
					<h:outputLabel value="Proprietário:" styleClass="control-label" />
					<p:selectOneMenu style="margin-top: 4px;width:100%;" appendTo="@(this)" filter="true" 
					 converter="#{componentConverterPessoa}" filterMatchMode="contains" id="proprietario"
					 required="true" requiredMessage="Proprietário: Campo obrigatório!"
						value="#{apartamentoService.apartamento.proprietario}" >
			            <f:selectItem itemLabel="Selecione" itemValue="" />
			            <f:selectItems value="#{pessoaService.listaProprietariosSelect()}" var="select" 
								itemLabel="#{select.nome}" itemValue="#{select}" />
			        </p:selectOneMenu>
					<p:commandButton icon="fa fa-share-square-o" value="ADD PROPRIETÁRIO"
						action="#{pessoaService.add('Proprietario')}" process="@this" 
						styleClass="noui zoom btn btn-primary btn-xs" />
				</b:panelGrid>
				
				<!-- BLOCO/PREDIO -->
				<b:panelGrid colSpans="2,5,5" size="sm" id="selectPredio">
					<h:outputLabel value="Bloco/Prédio:" styleClass="control-label" />
					<p:selectOneMenu style="margin-top: 4px;width:100%;" appendTo="@(this)" filter="true" 
					 converter="#{componentConverterPredio}" filterMatchMode="contains" id="predio"
					 required="true" requiredMessage="Prédio: Campo obrigatório!"
						value="#{apartamentoService.apartamento.predio}" >
			            <f:selectItem itemLabel="Selecione" itemValue="" />
			            <f:selectItems value="#{predioService.findAll().toArray()}" var="select" 
								itemLabel="#{select.nome}" itemValue="#{select}" />
			        </p:selectOneMenu>
					<p:commandButton icon="fa fa-share-square-o" value="ADD BLOCO"
						actionListener="#{predioService.add}" process="@this" 
						styleClass="noui zoom btn btn-primary btn-xs" />
				</b:panelGrid>
				
				<!-- IDENTIFICADOR -->
				<b:panelGrid colSpans="2,10" size="sm">
					<h:outputLabel value="Identificador:" styleClass="control-label" />
					<b:inputText size="10" value="#{apartamentoService.apartamento.identificador}"
						required="true" requiredMessage="Identificador: obrigatório"
						disabled="#{apartamentoService.apartamento.idApartamento > 0 ? 'true' : 'false'}"
						readonly="#{apartamentoService.apartamento.idApartamento > 0 ? 'true' : 'false'}" />
				</b:panelGrid>
				
				<!-- VALOR DIARIA / METROS QUADRADOS -->
				<b:panelGrid colSpans="2,4,2,4" size="sm">
				
					<h:outputLabel value="Valor diária:" styleClass="control-label" />
					<p:inputText size="10" value="#{apartamentoService.apartamento.valorDiaria}"
					required="true" requiredMessage="Valor diária: obrigatório"
					onkeyup="moeda(this)" maxlength="10" id="valorDiaria" >
						<f:convertNumber pattern="#,##0.00" />
					</p:inputText>
					
					<h:outputLabel value="m²:" styleClass="control-label" />
					<p:inputText size="5" value="#{apartamentoService.apartamento.metrosQuadrados}" maxlength="5" />
					
				</b:panelGrid>
				
				<!-- DIARIAS -->
				<h:panelGroup layout="block" id="formRemoveDiaria">
				<b:row rendered="#{apartamentoService.apartamento.apartamentoDiarias.size()>0}" style="margin-bottom:5px;">
						<b:row styleClass="show-grid" >
					    	<b:column col-sm="10" offset-sm="2">
					    	<b>Remover | DataInicio | DataFim | Valor da diária | Nome</b>  
					    	</b:column>
					    </b:row>
					    <ui:repeat value="#{apartamentoService.apartamento.apartamentoDiarias.toArray()}" var="apDiaria">
							<b:row styleClass="show-grid" style="margin-bottom:3px;" >
						    	<b:column col-sm="10" offset-sm="2">
						    		<p:commandButton styleClass="zoom btn-warning btn-xs" style="margin:0px 17px;" process="@this" update="formApartamento:formRemoveDiaria" action="#{apartamentoService.removeDiaria(apDiaria)}" icon="fa fa-minus-circle" /> 
						    		de <h:outputText value="#{apDiaria.dataInicio}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText>
									a <h:outputText value="#{apDiaria.dataFim}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText>
									[ <h:outputText value="R$ #{apDiaria.valor}" ><f:convertNumber pattern="#,##0.00" /></h:outputText>
									- <h:outputText value="#{apDiaria.nome}" />
									]
						    	</b:column>
						    </b:row>
						</ui:repeat>
				</b:row>
				</h:panelGroup>
				<b:panelGrid colSpans="2,10" size="sm" id="formAddDiaria">
					<h:outputLabel value="Diária:" styleClass="control-label" style="margin-top: 3px;" />
					<b:panelGrid colSpans="3,3,2,2,2" size="sm">
						<p:calendar styleClass="diariaData" pt:placeholder="Data Inicio" mask="true" locale="pt"
							value="#{apartamentoService.apartamentoDiaria.dataInicio}" pattern="dd/MM/yyyy" >
						</p:calendar>
						<p:calendar styleClass="diariaData" pt:placeholder="Data Fim" mask="true" locale="pt"
							value="#{apartamentoService.apartamentoDiaria.dataFim}" pattern="dd/MM/yyyy" >
						</p:calendar>
						<p:inputText style="margin-top:3px;" pt:placeholder="Valor" size="10" value="#{apartamentoService.apartamentoDiaria.valor}"
							onkeyup="moeda(this)" maxlength="10" >
								<f:convertNumber pattern="#,##0.00" />
						</p:inputText>
						<b:inputText pt:placeholder="Nome" value="#{apartamentoService.apartamentoDiaria.nome}" style="margin-top: 3px;"/>
						<p:commandButton style="margin-top:4px;" styleClass="zoom btn-primary btn-xs" actionListener="#{apartamentoService.addDiaria}" process="formAddDiaria" update="formApartamento:formRemoveDiaria formApartamento:formAddDiaria" icon="fa fa-plus-circle" /> 
					</b:panelGrid>
				</b:panelGrid>
				<style>
				.diariaData input{
					margin-top:3px;
				}
				</style>
				
				
				<!-- LIMITES -->
				<div class="form-inline" style="margin-bottom:10px;">
					<div class="form-group">
						<h:panelGrid columns="2">
							<h:outputLabel value="Limite adultos:" styleClass="control-label" />
							<h:panelGroup layout="block" style="margin-right:10px;">
								<p:spinner style="margin-left: 10px; margin-top: 4px;" size="2" min="0" max="100" value="#{apartamentoService.apartamento.limiteAdulto}" />
							</h:panelGroup>	
						</h:panelGrid>
					</div>
					<div class="form-group">
						<h:panelGrid columns="2">
							<h:outputLabel value="Limite crianças:" styleClass="control-label" />
							<h:panelGroup layout="block" style="margin-right:10px;">
								<p:spinner style="margin-left: 10px; margin-top: 4px;" size="2" min="0" max="100" value="#{apartamentoService.apartamento.limiteCrianca}" />
							</h:panelGroup>
						</h:panelGrid>
					</div>
					<div class="form-group" >
						<h:panelGrid columns="2">
							<h:outputLabel value="Qnt vagas carro:" styleClass="control-label" />
							<h:panelGroup layout="block" >
								<p:spinner style="margin-left: 10px; margin-top: 4px;" size="2" min="0" max="100" value="#{apartamentoService.apartamento.qntVagas}" />
							</h:panelGroup>
						</h:panelGrid>
					</div>
				</div>
				
				<!-- ITENS -->
				<h:panelGroup layout="block" id="formRemoveItem">
				<b:row rendered="#{apartamentoService.apartamento.apartamentoItens.size()>0}" style="margin-bottom:5px;">
						<b:row styleClass="show-grid" >
					    	<b:column col-sm="10" offset-sm="2">
					    	<b>Remover | ( quantidade ) => Item</b>  
					    	</b:column>
					    </b:row>
					    <ui:repeat value="#{apartamentoService.apartamento.apartamentoItens.toArray()}" var="apItem">
							<b:row styleClass="show-grid" style="margin-bottom:3px;" >
						    	<b:column col-sm="10" offset-sm="2">
						    		<p:commandButton styleClass="zoom btn-warning btn-xs" style="margin:0px 17px;" process="@this" update="formApartamento:formRemoveItem" action="#{apartamentoService.removeItem(apItem)}" icon="fa fa-minus-circle" /> ( <h:outputText value="#{apItem.quantidade}" /> ) => <h:outputText value="#{apItem.nome}" />
						    	</b:column>
						    </b:row>
						</ui:repeat>
				</b:row>
				</h:panelGroup>
				<b:panelGrid colSpans="2,10" size="sm" id="formAddItem">
					<h:outputLabel value="Itens:" styleClass="control-label" style="margin-top: 3px;" />
					<b:panelGrid colSpans="2,7,3" size="sm">
						<p:spinner style="margin:2px;" size="2" min="1" max="100" value="#{apartamentoService.apartamentoItem.quantidade}" />
						<b:inputText pt:placeholder="Item" value="#{apartamentoService.apartamentoItem.nome}" style="margin-top: 3px;"/>
						<p:commandButton style="margin-top:4px;" styleClass="zoom btn-primary btn-xs" actionListener="#{apartamentoService.addItem}" process="formAddItem" update="formApartamento:formRemoveItem formApartamento:formAddItem" icon="fa fa-plus-circle" /> 
					</b:panelGrid>
				</b:panelGrid>
				
				
				<!-- OBS -->
				<b:panelGrid colSpans="2,10" size="sm">
					<h:outputLabel value="OBS:" styleClass="control-label" />
					<p:inputTextarea value="#{apartamentoService.apartamento.obs}" />
				</b:panelGrid>

				<!-- SUBMIT -->
				<b:row style="text-align:right;margin:0 10px;">
					<p:commandButton value="Enviar" icon="fa fa-thumbs-up"
						action="#{apartamentoService.saveOrUpdate}" update="messagesApartamento"
						styleClass="noui zoom btn btn-success" />
				</b:row>
				<!-- FIM SUBMIT -->
			</h:form>
			<!-- FIM FORM -->
		</b:modal>
		<!-- FIM MODAL -->

</ui:composition>